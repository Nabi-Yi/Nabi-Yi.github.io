---
title: "DNS"

categories:
  - Network
tags:
  - DNS
  - Domain Name System
---
### DNS란?
 DNS(Domain Name System)는 127.0.0.1과 같은 IP주소를 우리가 쉽게 알아 볼 수 있는 언어로 매칭하여 저장하고, 제공하는 것을 의미한다. 아버지의 전화번호가 010-0000-0000 라면 '아버지'라고 저장하여 사용 할 수 있게 해주는 것과 비슷하다고 볼 수 있다.(여기서 '아버지'에 해당하는 이름을 도메인이라 한다.)  

하지만 핸드폰 번호와는 달리 수억개의 인터넷 사이트 주소와 이름을 개인이 저장하고 있을 수는 없는 노릇이고, 때문에 일반적으로는 통신사 등(ISP)에서 이러한 서비스를 제공하게 된다. 심지어 이런 DNS서버조차 전세계의 수많은 도메인을 모두 저장하고 있지는 않기에 자신이 저장하지 않은 도메인에 대해선 다른 서버에 물어보는 과정을 거치게된다.  
 
때문에 우리가 www.google.com라는 주소를 입력하게 되면, DNS서버를 통해 구글의 IP주소를 얻고, 다시 이 IP주소로 찾아가서 너 구글 맞니? 응 맞아. 라는 식의 과정을 거치게 되는데, 이를 간략하게 알아보자.  
 
### 웹 주소의 구조
 https://www.google.com의 경우를 보면,**.com에 해당 하는 Top level Domain**라고 한다. kr, net, or, edu 등이 있다.  
이러한 탑 레벨 도메인을 담은 담은 루트 DNS서버가 있고, 탑 레벨 하위로 연결된 Second level 등의 (co.kr 에서 co, ac.kr 등에서 ac 등) 전형적인 **트리구조로 계층화** 되어 있다.  
 google에 해당하는 것은 host name 서비스의 이름을 나타내는 문자열이다. www는 호스트이다.  
이를 가장 윗 층계부터 역순으로 나열하는 것이 우리가 흔히 쓰는 도메인이라고 볼 수 있다.  

### DNS의 작동원리
작동원리..라고 하면 거창하지만 대충 우리가 도메인을 입력했을 때, 도메인 서버가 우리에게 IP주소를 알려주는 과정을 알아보자.  

![](https://nabi-yi.github.io/assets/images/220607_DNS.jpg){: .align-center}
###### *출처  : Codestates (https://codestates.com)*  

그림과 같이, 클라이언트(브라우저)가 도메인을 찾아줘! 라고 하면 이 요청을 DNS서버로 전송한다. 이 DNS서버는 앞서 말했듯 대부분 ISP(KT같은 인터넷 제공 사업자) 혹은 google이나 cloudflare(1.1.1.1)같은 업체 등에서 운영한다.  

이 DNS서버가 그림에서 표시된 resolver로 볼 수 있는데, 만약 이 때 서버에 해당 도메인에 대한 IP정보가 저장되어있으면 바로 주소를 클라이언트에게 알려준다.  
만약 저장하고 있지 않다면, Root부터 호스트 도메인까지 재귀방식으로 자신의 하위 계층 서버에게 너 이거 알고 있니?라고 물어보는 과정을 거친다.  

www.google.com에 대한 ip주소를 알아내는 과정을 순서로 보면 대략 이렇다.  

1. DNS resolver에서 Root서버에 .com에 대한 정보가 있는지 물어본다.
2. Root서버에서 .com 도메인 서버 주소를 알려준다.
3. Resolver는 .com서버에 가서 google.com에 대한 정보가 있는지 물어본다.
4. .com서버에서 google 도메인 서버 주소를 알려준다.
5. resolver가 google.com에 가서 www.google.com에 대해 물어보고 알려 준다.. 등등  
6. IP주소를 얻어내면, DNS서버의 캐시에 해당 정보를 저장하고, IP를 클라이언트에 알려준다.

이렇게 재귀를 거치며 클라이언트가 IP주소를 획득하면, 클라이언트는 해당 주소로 찾아가, 너 구글 맞니? 라고 물어보게 되고, 맞으면 http 응답 200을 받게되고 이 후 본격적인 http message를 주고 받는다.  


### DNS 기타
 * DNS는 53번 port로 평문 전송을 한다.  
 * cloudflare등에서는 이런 점을 개선하여 DNS over TLS등의 방법을 사용한다.  
 * IP주소로 도메인 네임을 찾는 reverse DNS도 있다.
 * 위 과정 처럼 우리는 인터넷을 사용할 때 일반적으로 가장 먼저 ISP의 DNS서버를 가장 먼저 거치게 되는데, KT와 같은 ISP는 정부의 감독에 있을 수 밖에 없고, 정부는 이를 통해 DNS서버로 불법 사이트의 도메인네임이 들어오면 경고 사이트로 연결시키는 등의 방법으로 검열을 할 수도 있다.

  


 